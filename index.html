<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Lazy S Ranch - Interactive Farm Map</title>
    
    <!-- Leaflet CSS -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: #2C3E2B;
        }

        .container {
            max-width: 100%;
            height: 100vh;
            display: flex;
            flex-direction: column;
        }

        .header {
            background: #2C3E2B;
            color: white;
            padding: 1rem 2rem;
        }

        .header h1 {
            font-size: 1.5rem;
            margin-bottom: 0.3rem;
        }

        .header .subtitle {
            color: #ccc;
            font-size: 0.9rem;
        }

        .map-wrapper {
            display: grid;
            grid-template-columns: 1fr 380px;
            flex: 1;
            overflow: hidden;
        }

        #map {
            width: 100%;
            height: 100%;
        }

        .info-panel {
            background: white;
            padding: 2rem;
            overflow-y: auto;
            box-shadow: -4px 0 16px rgba(0,0,0,0.2);
        }

        .info-panel.empty {
            display: flex;
            align-items: center;
            justify-content: center;
            color: #999;
            font-style: italic;
            text-align: center;
        }

        .block-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 1rem;
            padding-bottom: 1rem;
            border-bottom: 3px solid #f0f0f0;
        }

        .block-header h2 {
            color: #2C3E2B;
            font-size: 1.8rem;
            margin: 0;
        }

        .block-color-indicator {
            width: 35px;
            height: 35px;
            border-radius: 8px;
            border: 3px solid #333;
        }

        .block-variety {
            color: #E67E22;
            font-size: 1.1rem;
            font-weight: 600;
            margin-bottom: 1.5rem;
        }

        .stat-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 0.8rem;
            margin-bottom: 1.5rem;
        }

        .stat-box {
            background: linear-gradient(135deg, #f9f9f9 0%, #f0f0f0 100%);
            padding: 1rem;
            border-radius: 8px;
            border-left: 4px solid #4A6741;
        }

        .stat-label {
            font-size: 0.75rem;
            color: #666;
            margin-bottom: 0.4rem;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .stat-value {
            font-size: 1.3rem;
            font-weight: 700;
            color: #2C3E2B;
        }

        .info-section {
            margin-top: 1.2rem;
            padding-top: 1.2rem;
            border-top: 2px solid #f0f0f0;
        }

        .info-section h3 {
            color: #2C3E2B;
            font-size: 1rem;
            margin-bottom: 0.7rem;
        }

        .info-row {
            display: flex;
            justify-content: space-between;
            padding: 0.4rem 0;
            border-bottom: 1px solid #f0f0f0;
        }

        .info-row:last-child {
            border-bottom: none;
        }

        .info-label {
            color: #666;
            font-weight: 500;
            font-size: 0.9rem;
        }

        .info-value {
            color: #2C3E2B;
            font-weight: 600;
            font-size: 0.9rem;
        }

        .performance-badge {
            display: inline-block;
            padding: 0.5rem 1rem;
            border-radius: 20px;
            font-weight: 600;
            font-size: 0.85rem;
            margin-top: 1rem;
        }

        .performance-excellent {
            background: #4CAF50;
            color: white;
        }

        .performance-good {
            background: #FFC107;
            color: #333;
        }

        .performance-needs-attention {
            background: #F44336;
            color: white;
        }

        /* Custom Leaflet popup */
        .leaflet-popup-content-wrapper {
            border-radius: 8px;
        }

        .leaflet-popup-content {
            margin: 0.8rem;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        /* Close button */
        .close-panel-btn {
            position: absolute;
            top: 10px;
            right: 10px;
            background: #E67E22;
            color: white;
            border: none;
            border-radius: 50%;
            width: 36px;
            height: 36px;
            font-size: 24px;
            cursor: pointer;
            display: none;
            z-index: 10;
            box-shadow: 0 2px 8px rgba(0,0,0,0.3);
        }

        /* Mobile responsive */
        @media (max-width: 768px) {
            .map-wrapper {
                grid-template-columns: 1fr;
                grid-template-rows: 1fr;
                position: relative;
            }

            .header h1 {
                font-size: 1.2rem;
            }

            .info-panel {
                position: fixed;
                bottom: 0;
                left: 0;
                right: 0;
                height: 85vh;
                max-height: 85vh;
                transform: translateY(100%);
                transition: transform 0.3s ease-in-out;
                z-index: 1001;
                border-radius: 20px 20px 0 0;
                box-shadow: 0 -4px 20px rgba(0,0,0,0.3);
            }

            .info-panel.visible {
                transform: translateY(0);
            }

            .info-panel.empty {
                transform: translateY(100%);
            }

            .close-panel-btn {
                display: block;
            }

            #map {
                height: 100%;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üçä Lazy S Ranch - Interactive Farm Map</h1>
            <p class="subtitle">Click on any block to view detailed performance data</p>
        </div>

        <div class="map-wrapper">
            <div id="map"></div>

            <div id="infoPanel" class="info-panel empty">
                <button class="close-panel-btn" onclick="closePanel()">√ó</button>
                üëÜ Click on any block on the map to view its details
            </div>
        </div>
    </div>

    <!-- Leaflet JS -->
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>

    <script>
        // Wait for everything to load
        // Convert DMS to decimal: 36¬∞32'53.3"N 119¬∞11'35.2"W
        const farmCenter = [36.548139, -119.193111];

        // Block data with actual revenue from QuickBooks
                const blockData = {
            '1': {
                name: 'Block 1',
                variety: 'Clementines',
                color: '#16A085',
                yearPlanted: 2017,
                acres: 20,
                revenue: 85420,
                bins: 427,
                polygon: [[36.54388899788361, -119.1926764709963], [36.54389043578529, -119.1915488606289], [36.54386654873599, -119.1905455620044], [36.54641043809662, -119.1905693913337], [36.54653711611201, -119.19058611373], [36.54665477520575, -119.1906649338781], [36.54675514714337, -119.1908261629643], [36.54688938707562, -119.1908993915092], [36.54702778545521, -119.1908787807285], [36.54709903288771, -119.1907743258733], [36.54719124056419, -119.190685927224], [36.54728341905653, -119.1906182318085], [36.54784050664303, -119.19060291019], [36.54792440029373, -119.190660110033], [36.54795592698662, -119.1926234262614], [36.54388899788361, -119.1926764709963]]
            },
            '2a': {
                name: 'Block 2a',
                variety: 'Tangos',
                color: '#E67E22',
                yearPlanted: 2017,
                acres: 10,
                revenue: 52180,
                bins: 261,
                polygon: [[36.54798312156035, -119.1947166909783], [36.54607907619504, -119.1947289022963], [36.54607149887911, -119.1927233576559], [36.54798034377647, -119.1926908249756], [36.54798312156035, -119.1947166909783]]
            },
            '2b': {
                name: 'Block 2b',
                variety: 'Clementines',
                color: '#16A085',
                yearPlanted: 2014,
                acres: 10,
                revenue: 48300,
                bins: 242,
                polygon: [[36.54393786781007, -119.1947737636746], [36.54391435701906, -119.1927282846604], [36.54607062202214, -119.1927019912126], [36.54608553560469, -119.1947331093856], [36.54393786781007, -119.1947737636746]]
            },
            '3': {
                name: 'Block 3',
                variety: 'Washington Navels',
                color: '#F39C12',
                yearPlanted: 1964,
                acres: 20,
                revenue: 72500,
                bins: 363,
                polygon: [[36.54391723738012, -119.1967233745671], [36.54389755918233, -119.1948278177057], [36.5480130598604, -119.1947753632212], [36.54801553720105, -119.1967672252561], [36.54391723738012, -119.1967233745671]]
            },
            '4': {
                name: 'Block 4',
                variety: 'Valencia',
                color: '#9B59B6',
                yearPlanted: 1964,
                acres: 20,
                revenue: 95200,
                bins: 476,
                polygon: [[36.54757073943276, -119.2013104335203], [36.54752302126683, -119.196977016003], [36.54923534748979, -119.1969766598668], [36.54931075193996, -119.2013431922128], [36.54757073943276, -119.2013104335203]]
            },
            '5': {
                name: 'Block 5',
                variety: 'Valencia',
                color: '#9B59B6',
                yearPlanted: 1989,
                acres: 5,
                revenue: 22800,
                bins: 114,
                polygon: [[36.54918817132967, -119.1968410647627], [36.5491716062181, -119.1963506162262], [36.5492360992577, -119.1963358301732], [36.54923073438625, -119.1957746124134], [36.54913105355084, -119.1957529930236], [36.54900762240271, -119.1955420878282], [36.54900145999395, -119.1954620297936], [36.55055189726951, -119.195476207504], [36.55057641769734, -119.1968467641929], [36.54918817132967, -119.1968410647627]]
            },
            '6': {
                name: 'Block 6',
                variety: 'Valencia',
                color: '#9B59B6',
                yearPlanted: 1998,
                acres: 8,
                revenue: 36500,
                bins: 183,
                polygon: [[36.54900000723253, -119.1954390639697], [36.54899019557591, -119.1942441778363], [36.55164861068073, -119.1942317254963], [36.55165483455328, -119.1954375559678], [36.54900000723253, -119.1954390639697]]
            },
            '7': {
                name: 'Block 7',
                variety: 'Valencia',
                color: '#9B59B6',
                yearPlanted: 1998,
                acres: 24,
                revenue: 109200,
                bins: 546,
                polygon: [[36.54903107977725, -119.1940917998831], [36.54901452068771, -119.1903481728698], [36.55156075350859, -119.1903429004157], [36.55160927812719, -119.1940814162943], [36.54903107977725, -119.1940917998831]]
            },
            '8': {
                name: 'Block 8',
                variety: 'Lane Late',
                color: '#D35400',
                yearPlanted: 1998,
                acres: 20,
                revenue: 88600,
                bins: 443,
                polygon: [[36.54900790033025, -119.190312087551], [36.54904777237609, -119.1898094694645], [36.54908750254069, -119.1896314752155], [36.54914610951559, -119.1894937297383], [36.54917213470267, -119.1893640650627], [36.54915898196811, -119.1891856654339], [36.54912017938555, -119.1890319583845], [36.54910202968017, -119.1874550761425], [36.55154513458851, -119.1874676080405], [36.55156713171417, -119.1903122028432], [36.54900790033025, -119.190312087551]]
            },
            '9': {
                name: 'Block 9',
                variety: 'Cara Cara',
                color: '#C0392B',
                yearPlanted: 2013,
                acres: 20,
                revenue: 78900,
                bins: 395,
                polygon: [[36.55176977970005, -119.1908428949513], [36.5580923442955, -119.1908400582573], [36.55809070100511, -119.1910513883072], [36.55765015607678, -119.1914469893651], [36.55674430310118, -119.1920127582761], [36.55631647534025, -119.1921988374344], [36.55175514100096, -119.1921930936903], [36.55176977970005, -119.1908428949513]]
            },
            '10': {
                name: 'Block 10',
                variety: 'Powell',
                color: '#E67E22',
                yearPlanted: 2013,
                acres: 20,
                revenue: 82400,
                bins: 412,
                polygon: [[36.55176621450794, -119.1922085208346], [36.55622057254763, -119.1922023785348], [36.55604338176141, -119.1923808581026], [36.55601595900666, -119.1926526864883], [36.55588084955455, -119.1928306035867], [36.55500573393202, -119.1939857034758], [36.55177342099584, -119.1939796220141], [36.55176621450794, -119.1922085208346]]
            },
            '11': {
                name: 'Block 11',
                variety: 'Tangos',
                color: '#E67E22',
                yearPlanted: 2018,
                acres: 18,
                revenue: 215019,
                bins: 966,
                polygon: [[36.5517449299216, -119.1960022592875], [36.55176360398688, -119.1953127215348], [36.55171438451296, -119.1949937523239], [36.5517395541055, -119.1944868100792], [36.55178196121413, -119.1939795863592], [36.55487950973785, -119.1939773471869], [36.55483730911774, -119.1942186775914], [36.55465167054412, -119.1944839047074], [36.55442338610302, -119.1947810965657], [36.55421157966514, -119.1949208242849], [36.55413541432693, -119.1952263239805], [36.55413556481044, -119.1955728818247], [36.55404220740542, -119.1959221896654], [36.55377755068921, -119.1965129978279], [36.55347070338961, -119.1968354683701], [36.55176933612213, -119.1968291864074], [36.5517449299216, -119.1960022592875]]
            },
            '12': {
                name: 'Block 12',
                variety: 'Lemons',
                color: '#F1C40F',
                yearPlanted: 2013,
                acres: 18,
                revenue: 156800,
                bins: 784,
                polygon: [[36.55920663572121, -119.1876060292415], [36.55955357633982, -119.1881419305748], [36.55980474554456, -119.1881584074894], [36.55984979703214, -119.1887029846014], [36.55995279709466, -119.1881267152826], [36.55995359864011, -119.187546157515], [36.56112798256423, -119.1875359450479], [36.56115850519683, -119.1880993634294], [36.5612862015144, -119.1881875775271], [36.56131193515938, -119.1886657978645], [36.5608832225772, -119.1886813672249], [36.56073569171731, -119.1888490668118], [36.56028723473176, -119.1888797955282], [36.56037069693884, -119.1890638679211], [36.56042833496436, -119.189199841683], [36.56042175526611, -119.1899011773291], [36.56063868005402, -119.1902815818734], [36.56096295955174, -119.1900255674715], [36.56163346362633, -119.1904417780932], [36.56138471442048, -119.1909221232423], [36.5610383628748, -119.1906899249987], [36.56092989092199, -119.1907209032918], [36.5608285932657, -119.190658769951], [36.56063728670731, -119.1907760270812], [36.56038323295641, -119.1905839073151], [36.55885603752674, -119.1916006573263], [36.55841534637192, -119.1915387682588], [36.55838916894538, -119.1875494219864], [36.55920663572121, -119.1876060292415]]
            },
            '13': {
                name: 'Block 13',
                variety: 'Washington',
                color: '#F39C12',
                yearPlanted: 2017,
                acres: 6,
                revenue: 28500,
                bins: 143,
                polygon: [[36.54882272576622, -119.1954482496526], [36.54853173899928, -119.1957101253364], [36.54826345629002, -119.1961234051006], [36.54805776176618, -119.1964516214387], [36.54803513055442, -119.1961733868331], [36.54799185187773, -119.1908243028826], [36.548895743683, -119.1899000210127], [36.54891346119536, -119.1928132476922], [36.54882272576622, -119.1954482496526]]
            },
            '14': {
                name: 'Block 14',
                variety: 'Washington',
                color: '#F39C12',
                yearPlanted: 2020,
                acres: 10,
                revenue: 38200,
                bins: 191,
                polygon: [[36.54371962627393, -119.1931507488144], [36.54014633934262, -119.1931167333775], [36.54013831668377, -119.1920086305413], [36.5434891883319, -119.1920067379646], [36.5437186836351, -119.1922211448801], [36.54371962627393, -119.1931507488144]]
            },
            '15': {
                name: 'Block 15',
                variety: 'Ruby Red Grapefruit',
                color: '#E74C3C',
                yearPlanted: 2020,
                acres: 10,
                revenue: 41500,
                bins: 208,
                polygon: [[36.5436394339592, -119.1941815888158], [36.54017714855117, -119.1941539760002], [36.54015040397476, -119.1931370615168], [36.543716529456, -119.1932030239087], [36.543723941608, -119.1937363106305], [36.54373095871127, -119.1940071975459], [36.5436394339592, -119.1941815888158]]
            },
            '16': {
                name: 'Block 16',
                variety: 'Lemons',
                color: '#F1C40F',
                yearPlanted: 2020,
                acres: 20,
                revenue: 72300,
                bins: 362,
                polygon: [[36.53919235914905, -119.2012491480909], [36.53840902013804, -119.2012643615693], [36.53831404339139, -119.2011442277909], [36.53830680259762, -119.2009067716838], [36.53836543852528, -119.1999950017786], [36.53832912621061, -119.1993671618641], [36.53800146302211, -119.1993210071808], [36.53773254248343, -119.1991027881745], [36.5372611447267, -119.1989388249754], [36.53710137264332, -119.1988483096002], [36.53703605658679, -119.1987487817595], [36.53703689577441, -119.198504449176], [36.5369863961584, -119.1983236512323], [36.53658051384246, -119.1983236366681], [36.53650076215261, -119.1982152345253], [36.53648268752631, -119.1967726984733], [36.53909420455613, -119.196791280261], [36.53913085350686, -119.1968905521186], [36.53919235914905, -119.2012491480909]]
            },
            '17': {
                name: 'Block 17',
                variety: 'Tangos',
                color: '#E67E22',
                yearPlanted: 2020,
                acres: 11,
                revenue: 45600,
                bins: 228,
                polygon: [[36.5402606212168, -119.2012611202517], [36.53922734139367, -119.2012493044132], [36.53916955005675, -119.1969178293578], [36.53924242706073, -119.1967907270989], [36.540162233115, -119.1968426311175], [36.5401915880811, -119.1969605299457], [36.5402606212168, -119.2012611202517]]
            },
            '18': {
                name: 'Block 18',
                variety: 'Washington',
                color: '#F39C12',
                yearPlanted: 2020,
                acres: 40,
                revenue: 142000,
                bins: 710,
                polygon: [[36.54375754882471, -119.2013229267329], [36.54029875343466, -119.2012541465552], [36.54025840858507, -119.1972121650872], [36.54044161537993, -119.1968152775497], [36.54370902484448, -119.1968650203029], [36.54375754882471, -119.2013229267329]]
            },
            '19': {
                name: 'Block 19',
                variety: 'Cara Cara',
                color: '#C0392B',
                yearPlanted: 2020,
                acres: 12,
                revenue: 48700,
                bins: 244,
                polygon: [[36.53798173569568, -119.203540742764], [36.53791067330037, -119.2034184539915], [36.53804293661838, -119.2024136204474], [36.53817989799351, -119.2013376009903], [36.54020353591761, -119.2013566314398], [36.54021573095549, -119.2035706294387], [36.53798173569568, -119.203540742764]]
            },
        };

const blockDetails = {
    '1': {
        parcel: '036-210-005-000',
        type: 'Clementine',
        variety: 'Clementine',
        trees: 4437,
        treesPerAcre: 214
    },
    '2a': {
        parcel: '036-210-006-000',
        type: 'Tangos',
        variety: 'Murcott',
        trees: 2145,
        treesPerAcre: 222
    },
    '2b': {
        parcel: '036-210-006-000',
        type: 'Clementine',
        variety: 'Clementine',
        trees: 2665,
        treesPerAcre: 247
    },
    '3': {
        parcel: '036-210-007-000',
        type: 'Washington',
        variety: 'Navel',
        trees: 2204,
        treesPerAcre: 112
    },
    '4': {
        parcel: '035-350-004-000',
        type: 'Valencia',
        variety: 'Valencia',
        trees: 2030,
        treesPerAcre: 107
    },
    '5': {
        parcel: '036-210-008-000',
        type: 'Valencia',
        variety: 'Valencia',
        trees: 505,
        treesPerAcre: 106
    },
    '6': {
        parcel: '036-210-008-000',
        type: 'Valencia',
        variety: 'Valencia',
        trees: 768,
        treesPerAcre: 99
    },
    '7': {
        parcel: '036-210-003-000',
        type: 'Valencia',
        variety: 'Valencia',
        trees: 2253,
        treesPerAcre: 93
    },
    '8': {
        parcel: '036-210-003-000',
        type: 'Lane Late',
        variety: 'Navel',
        trees: 1992,
        treesPerAcre: 115
    },
    '9': {
        parcel: '036-010-055-000',
        type: 'Cara Cara',
        variety: 'Navel',
        trees: 4006,
        treesPerAcre: 214
    },
    '10': {
        parcel: '036-010-055-000',
        type: 'Powell',
        variety: 'Navel',
        trees: 3976,
        treesPerAcre: 239
    },
    '11': {
        parcel: '036-010-051-000',
        type: 'Tango',
        variety: 'Murcott',
        trees: 4449,
        treesPerAcre: 255
    },
    '12': {
        parcel: '036-010-002-000',
        type: 'Lisbon',
        variety: 'Lemon',
        trees: 2441,
        treesPerAcre: 116
    },
    '13': {
        parcel: '036-210-008-000',
        type: 'Washington',
        variety: 'Navel',
        trees: 1696,
        treesPerAcre: 352
    },
    '14': {
        parcel: '036-030-003-000',
        type: 'Washington',
        variety: 'Navel',
        trees: 2385,
        treesPerAcre: 230
    },
    '15': {
        parcel: '036-030-003-000',
        type: 'Star Ruby',
        variety: 'Grapefruit',
        trees: 1296,
        treesPerAcre: 135
    },
    '16': {
        parcel: '035-060-029-000',
        type: 'Lisbon',
        variety: 'Lemon',
        trees: 2530,
        treesPerAcre: 123
    },
    '17': {
        parcel: '035-060-029-000',
        type: 'Tango',
        variety: 'Murcott',
        trees: 2966,
        treesPerAcre: 278
    },
    '18': {
        parcel: '035-060-029-000',
        type: 'Washington',
        variety: 'Navel',
        trees: 9579,
        treesPerAcre: 241
    },
    '19': {
        parcel: '035-060-029-000',
        type: 'Cara Cara',
        variety: 'Navel',
        trees: 2910,
        treesPerAcre: 252
    },
};


        let map;
        let currentPolygon = null;

        function initMap() {
            // Initialize map centered on farm
            map = L.map('map', {
                center: farmCenter,
                zoom: 17,
                zoomControl: true
            });

            // Add satellite imagery (using ESRI World Imagery - free)
            L.tileLayer('https://server.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}', {
                attribution: 'Tiles &copy; Esri',
                maxZoom: 19
            }).addTo(map);

            // Add blocks as polygons
            Object.keys(blockData).forEach(blockId => {
                const block = blockData[blockId];
                
                const polygon = L.polygon(block.polygon, {
                    color: block.color,
                    fillColor: block.color,
                    fillOpacity: 0.4,
                    weight: 2
                }).addTo(map);

                // Add label
                const center = polygon.getBounds().getCenter();
                L.marker(center, {
                    icon: L.divIcon({
                        className: 'block-label',
                        html: `<div style="background: rgba(0,0,0,0.7); color: white; padding: 2px 6px; border-radius: 4px; font-weight: bold; font-size: 12px; white-space: nowrap; display: inline-block;">${block.name.replace('Block ', '')}</div>`,
                        iconSize: [30, 20]
                    })
                }).addTo(map);

                // Click handler
                polygon.on('click', () => {
                    selectBlock(blockId, polygon);
                });

                // Hover effect
                polygon.on('mouseover', function() {
                    if (currentPolygon !== this) {
                        this.setStyle({ fillOpacity: 0.6 });
                    }
                });

                polygon.on('mouseout', function() {
                    if (currentPolygon !== this) {
                        this.setStyle({ fillOpacity: 0.4 });
                    }
                });
            });
        }


        function closePanel() {
            const panel = document.getElementById('infoPanel');
            panel.classList.remove('visible');
            if (currentPolygon) {
                currentPolygon.setStyle({ 
                    fillOpacity: 0.4,
                    weight: 2
                });
            }
            currentPolygon = null;
        }

        function showPanel() {
            const panel = document.getElementById('infoPanel');
            panel.classList.add('visible');
        }

        function selectBlock(blockId, polygon) {
            // Reset previous selection
            if (currentPolygon) {
                currentPolygon.setStyle({ 
                    fillOpacity: 0.4,
                    weight: 2
                });
            }

            // Highlight selected
            polygon.setStyle({ 
                fillOpacity: 0.7,
                weight: 4
            });
            currentPolygon = polygon;

            const block = blockData[blockId];

            // Calculate metrics
            const binsPerAcre = (block.bins / block.acres).toFixed(1);
            const dollarPerBin = (block.revenue / block.bins).toFixed(2);
            const dollarPerAcre = (block.revenue / block.acres).toFixed(2);
            const treeAge = 2025 - block.yearPlanted;

            // Determine performance
            let performanceClass, performanceText;
            if (block.revenue > 100000) {
                performanceClass = 'performance-excellent';
                performanceText = 'üü¢ Excellent Performance';
            } else if (block.revenue > 60000) {
                performanceClass = 'performance-good';
                performanceText = 'üü° Good Performance';
            } else {
                performanceClass = 'performance-needs-attention';
                performanceText = 'üî¥ Needs Attention';
            }

            // Update info panel
            const panel = document.getElementById('infoPanel');
            panel.className = 'info-panel';
            showPanel();
            panel.innerHTML = `
                <div class="block-header">
                    <h2>Block ${blockId}</h2>
                    <div class="block-color-indicator" style="background: ${block.color};"></div>
                </div>
                
                <div class="block-variety">${blockDetails[blockId]?.type || block.variety}</div>

                <div class="info-section" style="margin-top: 0; padding-top: 0; border-top: none;">
                    <h3>üìä ${new Date().getFullYear() - 1} Financials</h3>
                </div>

                <div class="stat-grid">
                    <div class="stat-box">
                        <div class="stat-label">Yearly Revenue</div>
                        <div class="stat-value">$${block.revenue.toLocaleString()}</div>
                    </div>
                    <div class="stat-box">
                        <div class="stat-label">Total Bins</div>
                        <div class="stat-value">${block.bins.toLocaleString()}</div>
                    </div>
                    <div class="stat-box">
                        <div class="stat-label">$/Bin</div>
                        <div class="stat-value">$${dollarPerBin}</div>
                    </div>
                    <div class="stat-box">
                        <div class="stat-label">Bins/Acre</div>
                        <div class="stat-value">${binsPerAcre}</div>
                    </div>
                    <div class="stat-box">
                        <div class="stat-label">$/Acre</div>
                        <div class="stat-value">$${parseFloat(dollarPerAcre).toLocaleString()}</div>
                    </div>
                    
                </div>

                <div class="info-section">
                    <h3>üìã Block Details</h3>
                    <div class="info-row">
                        <span class="info-label">Parcel No.</span>
                        <span class="info-value">${blockDetails[blockId]?.parcel || 'N/A'}</span>
                    </div>
                    <div class="info-row">
                        <span class="info-label">Type</span>
                        <span class="info-value">${blockDetails[blockId]?.type || block.variety}</span>
                    </div>
                    <div class="info-row">
                        <span class="info-label">Variety</span>
                        <span class="info-value">${blockDetails[blockId]?.variety || block.variety}</span>
                    </div>
                    <div class="info-row">
                        <span class="info-label">Year Planted</span>
                        <span class="info-value">${block.yearPlanted}</span>
                    </div>
                    <div class="info-row">
                        <span class="info-label">Tree Age</span>
                        <span class="info-value">${treeAge} years</span>
                    </div>
                    <div class="info-row">
                        <span class="info-label">Planted Acres</span>
                        <span class="info-value">${block.acres}</span>
                    </div>
                    <div class="info-row">
                        <span class="info-label"># of Trees</span>
                        <span class="info-value">${blockDetails[blockId]?.trees.toLocaleString() || 'N/A'}</span>
                    </div>
                    <div class="info-row">
                        <span class="info-label">Trees Per Acre</span>
                        <span class="info-value">${blockDetails[blockId]?.treesPerAcre || 'N/A'}</span>
                    </div>
                </div>
                </div>
            `;

            // Pan map to block
            map.panTo(polygon.getBounds().getCenter());
        }

        // Initialize when page loads
        window.addEventListener('load', initMap);
        

    </script>
</body>
</html>

